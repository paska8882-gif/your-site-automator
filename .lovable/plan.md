

## Задача: Сделать n8n генератор доступным для всех пользователей

Сейчас n8n генератор доступен только админам на вкладке `/admin?tab=n8n-generator`. Нужно перенести его в общее меню, чтобы обычные покупатели тоже могли им пользоваться, и чтобы генерации учитывались в статистике команды (team_id, sale_price).

### Основные проблемы текущей реализации

1. **Нет team_id** -- при вставке в `generation_history` не передаётся `team_id`, поэтому генерации не попадают в статистику команды.
2. **Нет sale_price** -- не списывается баланс команды.
3. **Только админ-доступ** -- компонент находится только в админ-вкладке.

### План реализации

#### 1. Создать новую страницу `/n8n-generator`
- Создать `src/pages/N8nGenerator.tsx` (аналогично `src/pages/Index.tsx`)
- Обернуть в `AppLayout`, добавить проверку авторизации
- Подключить `N8nGenerationPanel` как основной контент

#### 2. Добавить маршрут в `App.tsx`
- Добавить `<Route path="/n8n-generator" element={<N8nGenerator />} />`

#### 3. Добавить пункт в боковое меню (`AppSidebar.tsx`)
- Добавить в `getMainNavItems` новый пункт "n8n Генератор" с иконкой `Bot` и ссылкой `/n8n-generator`
- Оставить пункт и в админ-секции для обратной совместимости (или убрать, чтобы не дублировать)

#### 4. Интегрировать team_id и sale_price в `N8nGenerationPanel.tsx`
Это ключевое изменение для учёта статистики:

- Добавить логику выбора команды (как в `WebsiteGenerator`) -- загрузка `team_members` -> определение `team_id`
- При insert в `generation_history` передавать `team_id` и `sale_price` (рассчитанную по ценам команды)
- Проверять баланс команды перед генерацией (как это делает основной генератор)
- Списывать баланс команды при успешной отправке

#### 5. Добавить локализацию
- Добавить ключи перевода в `src/locales/ru.ts` и `src/locales/uk.ts` для нового пункта меню

---

### Технические детали

**Файлы, которые будут изменены:**
- `src/pages/N8nGenerator.tsx` -- новый файл, страница-обёртка
- `src/App.tsx` -- добавление маршрута
- `src/components/AppSidebar.tsx` -- добавление пункта меню
- `src/components/N8nGenerationPanel.tsx` -- добавление team_id, sale_price, проверки баланса
- `src/locales/ru.ts`, `src/locales/uk.ts` -- переводы

**Логика привязки к команде:**
```text
1. Загрузить team_members для user_id
2. Определить team_id (первая команда пользователя)
3. Загрузить pricing команды (html_price из teams)
4. При генерации: проверить баланс >= -credit_limit + price
5. Insert в generation_history с team_id и sale_price
6. Обновить balance команды (вычесть sale_price)
```

**Что НЕ меняется:**
- Edge functions (n8n-async-proxy, n8n-callback) -- они не зависят от team_id
- Админская вкладка n8n-generator останется в админке (по желанию можно убрать или оставить как "админский режим" без списания)

