
# Проблема з Senior AI React генерацією

## Діагноз

Після детального аналізу коду виявлено **кілька критичних проблем**:

### 1. Архітектура CDN-based React (головна проблема)

**Поточний підхід** (`generate-react-website/index.ts`, рядки 1136-1437):
- AI генерує HTML-файли з інлайновим React кодом
- React/ReactDOM/Babel завантажуються через CDN (unpkg.com)
- Весь JSX компілюється **в браузері на льоту**

**Чому це ламається:**
1. **Babel у браузері** - повільно і ненадійно
2. **CDN залежності** - якщо unpkg.com гальмує, сайт не рендериться
3. **Синтаксичні помилки AI** - найменша помилка в JSX = білий екран
4. **Відсутність error handling** - помилки Babel "з'їдаються" без логів

### 2. Дублювання компонентів

Кожна HTML-сторінка містить **повну копію** Header, Footer, CookieBanner (рядки 1292-1295):
```
Components are DUPLICATED across files (each file is self-contained)
```

Це означає ~300-400 рядків дублікату на кожній сторінці. AI часто робить помилки при копіюванні.

### 3. Gemini 2.5 Pro ігнорує інструкції

Senior AI використовує `google/gemini-2.5-pro` (рядок 2087). Ця модель:
- Часто генерує стандартний React проект з `import/export`
- Ігнорує інструкцію "NO build step"
- Створює `package.json`, `src/` папку, які потім **видаляються** валідатором (рядки 2231-2244)

### 4. Preview система не обробляє помилки

`FilePreview.tsx` просто рендерить HTML в iframe. Якщо Babel не може скомпілювати JSX - білий екран без повідомлення про помилку.

---

## План виправлення

### Фаза 1: Покращення помилок та логування

**Файл: `src/components/FilePreview.tsx`**
- Додати перехоплення помилок Babel в iframe
- Показувати зрозуміле повідомлення замість білого екрану
- Логувати помилки JSX для дебагу

### Фаза 2: Виправлення промпту генерації

**Файл: `supabase/functions/generate-react-website/index.ts`**

Оновити `REACT_GENERATION_PROMPT`:
1. Додати явний приклад повного index.html (не скорочений)
2. Додати **перевірку синтаксису** перед відправкою
3. Посилити інструкції про заборону `import/export`
4. Додати fallback структуру при помилках

### Фаза 3: Валідація React-коду

**Файл: `supabase/functions/generate-react-website/index.ts`**

Додати функцію `validateReactSyntax()`:
1. Перевіряти наявність `type="text/babel"` в кожному HTML
2. Перевіряти відсутність `import`/`export` statements
3. Перевіряти закриті теги в JSX
4. Автоматично виправляти типові помилки

### Фаза 4: Альтернативний підхід (запасний)

Якщо CDN-React не працює після виправлень, розглянути:
1. **Vanilla HTML/JS** замість React для Senior AI
2. **Переключення на HTML генерацію** з інтерактивністю через vanilla JS

---

## Технічні деталі

### Нові/змінені файли:

1. `supabase/functions/generate-react-website/index.ts`
   - Оновити REACT_GENERATION_PROMPT (~100 рядків)
   - Додати validateReactSyntax() (~50 рядків)
   - Покращити fixBrokenJsxSyntax() (~30 рядків)

2. `src/components/FilePreview.tsx`
   - Додати error boundary для iframe (~40 рядків)
   - Інжектити error handler script в preview (~30 рядків)

3. `src/components/SimplePreview.tsx`
   - Аналогічні зміни для error handling

### Орієнтовний час: 30-45 хвилин

---

## Альтернатива (якщо React залишається проблемним)

**Тимчасово вимкнути React для Senior AI:**
- Залишити тільки HTML генерацію
- React зробити "Coming Soon" (вже частково зроблено)
- Сфокусуватись на стабільній HTML генерації

Це дозволить:
- Не блокувати користувачів
- Мати час на якісне виправлення React
- Зберегти репутацію Senior AI
